import Head from "next/head";
import Link from "next/link";
import Image from "next/image";

import {useForm} from "react-hook-form";
import Axios from "axios";
import {useRouter} from "next/router";
import {useAuthDispatch, useAuthState} from "../context/auth";

export default function Home() {

  const {register, handleSubmit, formState: {errors}} = useForm();
  const router = useRouter();
  const dispatch = useAuthDispatch();
  const {authenticated} = useAuthState();

  if (authenticated) {
    router.push('/homepage');
  }



  const onSubmit = async (data, e) => {
    e.preventDefault();

    console.log(data)

    try {
      const res = await Axios.post("/users", {
        email: data.email,
        username: data.username,
        password: data.password,
      })

      dispatch("LOGIN", res.data);
      router.push('/homepage')
    } catch (err) {
      console.log(err)
    }

  }


  return (
    <div>
      <Head>
        <title>캡스톤</title>
        <meta name="description" content="Generated by create next app"/>
        <link rel="icon" href="/favicon.ico"/>
      </Head>

      <main className="flex h-screen items-center justify-between">
        {/*image*/}
        <div className="ml-40 basis-1/5 relative h-96 w-10 overflow-hidden rounded-t-full">
          <Image src="/index_pic.jpg" layout="fill" objectFit="cover"/>
        </div>

        {/*로그인 회원 가입*/}
        <div className="basis-4/5 flex flex-col items-center space-y-6">
          <div className="text-7xl">
            렌트허브
          </div>

          {/* "handleSubmit" will validate your inputs before invoking "onSubmit" */}
          <form onSubmit={handleSubmit(onSubmit)} className="flex-col flex justify-center">
            <label
              htmlFor="email"
              className="block text-sm font-semibold text-gray-800"
            >
              이메일
            </label>
            <input type="email" {...register("email")}
                   className="border-2 border-gray-300 rounded-sm"/>

            <label
              htmlFor="email"
              className="block text-sm font-semibold text-gray-800 "
            >
              닉네임
            </label>
            <input type="text" {...register("username", {required: true})}
                   className="border-2 border-gray-300 rounded-sm"/>
            {errors.username && <span>유저네임</span>}

            <label
              htmlFor="email"
              className="block text-sm font-semibold text-gray-800 "
            >
              비밀번호
            </label>
            <input {...register("password", {required: true})}
                   className="border-2 border-gray-300 rounded-sm "/>
            {errors.password && <span>비밀번호</span>}

            <div className="flex justify-between mt-6">
              <button className="p-1 px-2 space-x-2 text- font-bold border-2
           border-gray-400 w-fit rounded-md
           cursor-pointer hover:border-blue-300 transition"
                      type="submit">
                로그인
              </button>

              <div className="p-1 px-2 space-x-2 text- font-bold border-2
           border-gray-400 w-fit rounded-md
           cursor-pointer hover:border-blue-300  transition">
                <Link href="/register">회원가입</Link>
              </div>
            </div>
          </form>

        </div>
      </main>
    </div>
  );
}
